<template>
  <div style="min-height: 100%">
    <EasyNormalContainer :buttonList="buttonList" :title="title" @buttonClick="buttonClick" ref="container"
                         v-loading="loading" @disabled="setdisabled">
      <div slot="customize">
        <el-form :model="form" :rules="rules" label-position="top" label-width="8vw" ref="refform"
                 style="padding: 3vw">
          <!--            第一行-->
          <el-row>
            <!--            姓名-->
            <el-col :span="8">
              <el-form-item :error="errorexpname" :label="$t('label.user_name')"
                            prop="expname">
                <el-input :disabled="true" maxlength='36' style="width: 20vw"
                          v-model="form.expname"></el-input>
              </el-form-item>
            </el-col>
            <!--            性别-->
            <el-col :span="8">
              <el-form-item :label="$t('label.sex')" prop="sex">
                <dicselect
                  :code="code1"
                  :data="form.sex"
                  :disabled="true"
                  :multiple="multiple"
                  @change="changesex"
                  style="width:20vw"
                  v-model="form.sex">
                </dicselect>
              </el-form-item>
            </el-col>
            <!--            账号-->
            <el-col :span="8">
              <el-form-item :label="$t('label.PFANSUSERFORMVIEW_ADFIELD')" prop="accountname">
                <el-input
                  maxlength="100"
                  :disabled="!disabled"
                  style="width:20vw"
                  v-model="form.accountname">
                </el-input>
              </el-form-item>
            </el-col>
          </el-row>
          <!--            第二行-->
          <el-row>
            <!--            毕业院校-->
            <el-col :span="8">
              <el-form-item :label="$t('label.PFANS6001VIEW_GRADUATESCHOOL')" prop="graduateschool">
                <el-input :disabled="true" style="width:20vw" v-model="form.graduateschool" maxlength="50"></el-input>
              </el-form-item>
            </el-col>
            <!--            学历-->
            <el-col :span="8">
              <el-form-item :label="$t('label.PFANS2026VIEW_EDUCATIONALBACKGROUND')" prop="education">
                <dicselect
                  :code="code2"
                  :data="form.education"
                  :disabled="true"
                  :multiple="multiple"
                  @change="changeeducation"
                  style="width:20vw"
                  v-model="form.education">
                </dicselect>
              </el-form-item>
            </el-col>
            <!--            年龄-->
            <el-col :span="8">
              <el-form-item :label="$t('label.PFANSUSERFORMVIEW_AGE')">
                <el-input :disabled="true" style="width:20vw" v-model="age"></el-input>
              </el-form-item>
            </el-col>
          </el-row>
          <!--            第三行-->
          <el-row>
            <!--            供应商名称-->
            <el-col :span="8">
              <el-form-item :label="$t('label.PFANS6001VIEW_SUPPLIERNAME')" prop="suppliername">
                <el-input maxlength="255" :disabled="true" style="width:20vw" v-model="form.suppliername"></el-input>
              </el-form-item>
            </el-col>
            <!--            技术分类-->
            <!--<el-col :span="8">-->
            <!--<el-form-item :label="$t('label.PFANS2003VIEW_TECHNOLOGY')" prop="technology">-->
            <!--<dicselect-->
            <!--:code="code5"-->
            <!--:data="form.technology"-->
            <!--:disabled="true"-->
            <!--:multiple="multiple"-->
            <!--@change="changetechnology"-->
            <!--style="width:20vw">-->
            <!--</dicselect>-->
            <!--</el-form-item>-->
            <!--</el-col>-->
            <!--            Rn-->
            <el-col :span="8">
              <el-form-item :label="$t('label.PFANS6004FORMVIEW_RN')" prop="rn">
                <dicselect
                  :code="code4"
                  :data="form.rn"
                  :disabled="true"
                  :multiple="multiple"
                  @change="changern"
                  style="width:20vw">
                </dicselect>
              </el-form-item>
            </el-col>
            <!--           卒业年-->
            <el-col :span="8">
              <el-form-item :label="$t('label.PFANS2024VIEW_GRADUATIONYEAR')" prop="graduation_year">
                <el-date-picker
                  :disabled="true"
                  style="width:20vw"
                  type="year"
                  v-model="form.graduation_year">
                </el-date-picker>
              </el-form-item>
            </el-col>
          </el-row>
          <!--          第四行-->
          <el-row>
            <!--            所属部门-->
            <el-col :span="8">
              <el-form-item :error="errorgroup" :label="$t('label.department')" prop="group_id">
                <org :disabled="!disabled" :error="errorgroup" :orglist="grouporglist" @getOrgids="getGroupId"
                     orgtype="4" style="width:20vw"></org>
                <!--                    add_ccm_06/04  &#45;&#45;添加履历-->
                <el-button
                  type="text"
                  @click="dialogTableVisible9 = true"
                >{{$t('label.PFANSUSERFORMVIEW_PERSONAL')}}
                </el-button>
                <el-dialog
                  :title="$t('label.department') + $t('label.PFANSUSERFORMVIEW_PERSONAL')"
                  :visible.sync="dialogTableVisible9"
                >
                  <el-row>
                    <el-col :span="24">
                      <el-table :data="expData" stripe>
                        <el-table-column
                          property="date"
                          align="center"
                          :label="$t('label.PFANSUSERFORMVIEW_TIME')"
                          width="300"
                        >
                          <template slot-scope="scope">
                            <span style="color:#75a7ef">{{ scope.row.exdatestr }}</span>
                          </template>
                        </el-table-column>
                        <el-table-column
                          property="after"
                          align="center"
                          :label="$t('label.department')"
                        >
                          <template slot-scope="scope">
                            <span style="color:#75a7ef">{{ scope.row.groupname }}</span>
                          </template>
                        </el-table-column>
                      </el-table>
                    </el-col>
                  </el-row>
                </el-dialog>
                <!--                    add_fjl_05/21  &#45;&#45;添加履历-->
              </el-form-item>

            </el-col>
            <!--            作业场所-->
            <el-col :span="8">
              <el-form-item :label="$t('label.PFANS6004FORMVIEW_OPERATIONFORM')" prop="operationform">
                <dicselect
                  :code="code20"
                  :data="form.operationform"
                  :disabled="!disabled"
                  :multiple="multiple"
                  @change="changeoperationform"
                  style="width:20vw">
                </dicselect>
              </el-form-item>
            </el-col>
            <!--            邮箱-->
            <el-col :span="8">
              <el-form-item :label="$t('label.PFANSUSERFORMVIEW_EMAILADDRESS')">
                <el-input :disabled="!disabled" style="width:20vw" maxlength="100"
                          v-model="form.email"></el-input>
              </el-form-item>
            </el-col>
          </el-row>
          <!--          第五行-->
          <el-row>
            <!--            作业分类-->
            <el-col :span="8">
              <el-form-item :label="$t('label.PFANS6004FORMVIEW_JOBCLASSIFICATIONM')" prop="jobclassification">
                <dicselect
                  :code="code21"
                  :data="form.jobclassification"
                  :disabled="!disabled"
                  :multiple="multiple"
                  @change="changejobclassification"
                  style="width:20vw">
                </dicselect>
              </el-form-item>
            </el-col>
            <!--            入场时间-->
            <el-col :span="8">
              <el-form-item :error="erroradmissiontime" :label="$t('label.PFANS6004FORMVIEW_ADMISSIONTIME')"
                            prop="admissiontime">
                <el-date-picker
                  :disabled="!disabled"
                  style="width:20vw"
                  type="date"
                  v-model="form.admissiontime">
                </el-date-picker>
              </el-form-item>
            </el-col>
            <!--            编号变更卡号-->
            <!--1111-->
            <el-col :span="8">
              <el-form-item :label="$t('label.PFANSUSERFORMVIEW_JOBNUMBER')" prop="number">
                <el-input
                  :disabled="!disabled"
                  style="width:20vw"
                  v-model="form.number" maxlength="20">
                </el-input>
              </el-form-item>
            </el-col>
          </el-row>
          <!--                更衣柜号-->
          <el-row>
            <el-col :span="8">
              <el-form-item :label="$t('label.PFANSUSERFORMVIEW_LOCKERNUMBER')" prop="lockernumber">
                <el-input
                  :disabled="!disabled"
                  style="width:20vw"
                  v-model="form.lockernumber" maxlength="20">
                </el-input>
              </el-form-item>
            </el-col>
          </el-row>

          <el-row>
            <el-col :span="24">
              <el-form-item :label="$t('label.PFANS2003FORMVIEW_SPECIALITY')">
                <el-input :disabled="!disabled" :rows="2" style="width: 71vw" type="textarea"
                          v-model="form.speciality"></el-input>
              </el-form-item>
            </el-col>
          </el-row>
          <!--          第六行-->
          <el-collapse>
            <el-collapse-item>
              <template slot="title">
                <span class="collapse_Title">{{$t('label.PFANS6004VIEW_EXINTELLIGENCE')}}</span>
              </template>
              <!--          第七行-->
              <!--<el-row>-->
                <!--&lt;!&ndash;            退场与否&ndash;&gt;-->
                <!--<el-col :span="8">-->
                  <!--<el-form-item :label="$t('label.PFANS6004FORMVIEW_EXITS')" prop="exits">-->
                    <!--<span style="margin-right: 1vw ">{{$t('label.no')}}</span>-->
                    <!--<el-switch :disabled="!disabled"-->
                               <!--v-model="form.exits"-->
                               <!--active-value="0"-->
                               <!--inactive-value="1"-->
                               <!--@change="changeexits"-->
                    <!--&gt;</el-switch>-->
                    <!--<span style="margin-left: 1vw ">{{$t('label.yes')}}</span>-->
                  <!--</el-form-item>-->
                <!--</el-col>-->
              <!--          预计退场时间-->
              <el-row>
                <el-col :span="8">
                  <el-form-item :error="erroryjexitime" :label="$t('label.PFANS2002FORMVIEW_YJEXITTIME')" prop="yjexitime"
                  >
                    <el-date-picker
                      :disabled="!disabled"
                      style="width:20vw"
                      type="date"
                      v-model="form.yjexitime"
                      @change="chyjexitime"
                    >
                    </el-date-picker>
                  </el-form-item>
                </el-col>
              </el-row>

              <!--          第八行-->
              <el-row>

                <!--            退场时间-->
                <el-col :span="8">
                  <el-form-item :error="errorexitime" :label="$t('label.PFANS6004FORMVIEW_EXITIME')" prop="exitime">
                    <el-date-picker
                      :disabled="!disabled"
                      style="width:20vw"
                      type="date"
                      v-model="form.exitime"
                      @change="chexitime"
                    >
                    </el-date-picker>
                  </el-form-item>
                </el-col>
                <!--            退场理由-->
                <el-col :span="8">
                  <el-form-item :label="$t('label.PFANS6004FORMVIEW_EXITREASON')" prop="exitreason" >
                    <dicselect
                      :code="code6"
                      :data="form.exitreason"
                      :disabled="!disabled"
                      :multiple="multiple"
                      @change="changeexitreason"
                      style="width:20vw">
                    </dicselect>
                  </el-form-item>
                </el-col>
                <!--            所有技术-->
                <el-col :span="8">
                  <el-form-item :label="$t('label.PFANS6004FORMVIEW_ALLTECHNOLOGY')" prop="alltechnology" >
                    <!--                    <dicselect-->
                    <!--                      :code="code7"-->
                    <!--                      :data="form.alltechnology"-->
                    <!--                      :disabled="!disabled"-->
                    <!--                      :multiple="multiple"-->
                    <!--                      @change="changealltechnology"-->
                    <!--                      style="width:20vw">-->
                    <!--                    </dicselect>-->
                    <el-input :disabled="!disabled" style="width:20vw" maxlength="100"
                              v-model="form.alltechnology"></el-input>

                  </el-form-item>
                </el-col>
              </el-row>
              <!--          第九行-->
              <el-row>
                <!--            現場評価-->
                <el-col :span="8">
                  <el-form-item :label="$t('label.PFANS6004FORMVIEW_SITEVALUATION')" prop="sitevaluation" >
                    <dicselect
                      :code="code8"
                      :data="form.sitevaluation"
                      :disabled="!disabled"
                      :multiple="multiple"
                      @change="changesitevaluation"
                      style="width:20vw">
                    </dicselect>
                  </el-form-item>
                </el-col>
                <!--            業務影響-->
                <el-col :span="8">
                  <el-form-item :label="$t('label.PFANS6004FORMVIEW_BUSINESSIMPACT')" prop="businessimpact"
                                >
                    <dicselect
                      :code="code10"
                      :data="form.businessimpact"
                      :disabled="!disabled"
                      :multiple="multiple"
                      @change="changebusinessimpact"
                      style="width:20vw">
                    </dicselect>
                  </el-form-item>
                </el-col>
                <!--            対策-->
                <el-col :span="8">
                  <el-form-item :label="$t('label.PFANS6004FORMVIEW_COUNTERMEASURE')" prop="countermeasure"
                                >
                    <!--                    <dicselect-->
                    <!--                      :code="code9"-->
                    <!--                      :data="form.countermeasure"-->
                    <!--                      :disabled="!disabled"-->
                    <!--                      :multiple="multiple"-->
                    <!--                      @change="changecountermeasure"-->
                    <!--                      style="width:20vw">-->
                    <!--                    </dicselect>-->
                    <el-input :disabled="!disabled" style="width:20vw" maxlength="100"
                              v-model="form.countermeasure"></el-input>
                  </el-form-item>
                </el-col>
              </el-row>
            </el-collapse-item>
          </el-collapse>
          <!--          最后一行-->
          <!--          项目信息-->
          <el-collapse>
            <el-collapse-item>
              <template slot="title">
                <span class="collapse_Title">{{$t('label.PFANS6004VIEW_PROJECTINFORMATION')}}</span>
              </template>
              <el-table
                :data="tableData"
                header-cell-class-name="sub_bg_color_blue" stripe border
                style="width:100%"
              >
                <!--                部门-->
                <el-table-column
                  show-overflow-tooltip
                  prop="group_id"
                  :label="$t('label.department')"
                  width="200"
                >
                </el-table-column>
                <!--                项目-->
                <el-table-column
                  show-overflow-tooltip
                  prop="project_name"
                  :label="$t('label.PFANS5009VIEW_PROJECTNAME')"
                  width="200"
                >
                </el-table-column>
                <!--                项目类型-->
                <el-table-column
                  show-overflow-tooltip
                  prop="projecttype"
                  :label="$t('label.PFANS5001FORMVIEW_PROJECTTYPE')"
                  width="150"
                >
                </el-table-column>
                <!--                开始时间-->
                <el-table-column
                  prop="admissiontime"
                  :label="$t('label.PFANS5001FORMVIEW_STARTDATE')"
                  width="150"
                >
                </el-table-column>
                <!--                结束时间-->
                <el-table-column
                  prop="exittime"
                  :label="$t('label.end')"
                  width="150"
                >
                </el-table-column>
              </el-table>
            </el-collapse-item>
          </el-collapse>
        </el-form>
      </div>
    </EasyNormalContainer>
  </div>
</template>

<script>
    import EasyNormalContainer from '@/components/EasyNormalContainer';
    import PFANS6004View from '../PFANS6004/PFANS6004View.vue';
    import dicselect from '../../../components/dicselect.vue';
    import {Message} from 'element-ui';
    import moment from 'moment';
    import {getDictionaryInfo, getUserInfo,getOrgInfo} from '../../../../utils/customize';
    import org from '../../../components/org';

    export default {
        name: 'PFANS6004FormView',
        components: {
            EasyNormalContainer,
            PFANS6004View,
            dicselect,
            org,
        },
        data() {
            var checkexpname = (rule, value, callback) => {
                if (!value || value === '') {
                    this.errorexpname = this.$t('normal.error_09') + this.$t('label.user_name');
                    return callback(new Error(this.$t('normal.error_09') + this.$t('label.user_name')));
                } else {
                    this.errorexpname = '';
                    return callback();
                }
            };

            var checkgraduateschool = (rule, value, callback) => {
                if (!value || value === '') {
                    this.errorgraduateschool = this.$t('normal.error_09') + this.$t('label.PFANS6001VIEW_GRADUATESCHOOL');
                    return callback(new Error(this.$t('normal.error_09') + this.$t('label.PFANS6001VIEW_GRADUATESCHOOL')));
                } else {
                    this.errorgraduateschool = '';
                    return callback();
                }
            };

            var checkgroup = (rule, value, callback) => {
                if (!value || value === '') {
                    this.errorgroup = this.$t('normal.error_09') + this.$t('label.department');
                    return callback(new Error(this.$t('normal.error_09') + this.$t('label.department')));
                } else {
                    this.errorgroup = '';
                    return callback();
                }
            };
            var checksuppliername = (rule, value, callback) => {
                if (!value || value === '' || value === 'undefined') {
                    this.errorsuppliername = this.$t('normal.error_09') + this.$t('label.PFANS6001VIEW_SUPPLIERNAME');
                    return callback(new Error(this.$t('normal.error_09') + this.$t('label.PFANS6001VIEW_SUPPLIERNAME')));
                } else {
                    this.errorsuppliername = '';
                    return callback();
                }
            };
            var valadmissiontime = (rule, value, callback) => {
                if (this.form.exits == '0') {
                    if (this.form.exitime != null && this.form.exitime != '') {
                        if (moment(value).format('YYYY-MM-DD') > moment(this.form.exitime).format('YYYY-MM-DD')) {
                            callback(new Error(this.$t('label.PFANS6004FORMVIEW_ADMISSIONTIME') + this.$t('normal.error_checkTime2') + this.$t('label.PFANS2002FORMVIEW_EXITTIME')));
                            this.erroradmissiontime = this.$t('label.PFANS6004FORMVIEW_ADMISSIONTIME') + this.$t('normal.error_checkTime2') + this.$t('label.PFANS2002FORMVIEW_EXITTIME');
                        } else {
                            callback();
                            this.erroradmissiontime = '';
                            this.errorexitime = '';
                        }
                    }else {
                      callback();
                    }
                } else {
                    callback();
                    this.erroradmissiontime = '';
                }
            };
            var valyjexitime = (rule, value, callback) => {
              if (this.form.yjexitime != null && this.form.yjexitime != '') {
                if (moment(value).format('YYYY-MM-DD') < moment(this.form.admissiontime).format('YYYY-MM-DD')) {
                  callback(new Error(this.$t('label.PFANS2002FORMVIEW_YJEXITTIME') + this.$t('normal.error_checkTime1') + this.$t('label.PFANS2002FORMVIEW_ADMISSIONTIME')));
                  this.erroryjexitime = this.$t('label.PFANS2002FORMVIEW_YJEXITTIME') + this.$t('normal.error_checkTime1') + this.$t('label.PFANS2003FORMVIEW_INTERVIEWDATE');
                } else {
                  callback();
                  this.erroradmissiontime = '';
                  this.erroryjexitime = '';
                }
              } else {
                callback();
                this.erroryjexitime = '';
              }
            };
            var valexitime = (rule, value, callback) => {
                if (this.form.exitime != null && this.form.exitime != '') {
                    if (moment(value).format('YYYY-MM-DD') < moment(this.form.admissiontime).format('YYYY-MM-DD')) {
                        callback(new Error(this.$t('label.PFANS2002FORMVIEW_EXITTIME') + this.$t('normal.error_checkTime1') + this.$t('label.PFANS2002FORMVIEW_ADMISSIONTIME')));
                        this.errorexitime = this.$t('label.PFANS2002FORMVIEW_EXITTIME') + this.$t('normal.error_checkTime1') + this.$t('label.PFANS2003FORMVIEW_INTERVIEWDATE');
                    } else {
                        callback();
                        this.erroradmissiontime = '';
                        this.errorexitime = '';
                    }
                } else {
                    callback();
                    this.errorexitime = '';
                }
            };
            return {
                age: '',
                loading: false,
                selectType: 'Single',
                title: 'title.PFANS6004VIEW',
                errorexpname: '',
                errorsuppliername: '',
                erroradmissiontime: '',
                grouporglist: '',
                grouporglistflg: '',
                errorexitime: '',
                erroryjexitime: '',
                errorgroup: '',
                errorgraduateschool: '',
                expData: null,
                dialogTableVisible9: false,
                disabled: false,
                buttonList: [],
                multiple: false,
                search: '',
                gridData1: [],
                form: {
                    expatriatesinfor_id: '',
                    accountname: '',
                    expname: '',
                    cooperuserid: '',
                    sex: '',
                    group_id: '',
                    number: '',
                    post: '',
                    contactinformation: '',
                    suppliername: '',
                    suppliernameid: '',
                    graduateschool: '',
                    education: '',
                    graduation_year: '',
                    technology: '',
                    email: '',
                    rn: '',
                    operationform: '',
                    jobclassification: '',
                    admissiontime: moment(new Date()).format('YYYY-MM-DD'),
                    exitime: moment(new Date()).format('YYYY-MM-DD'),
                    yjexitime: moment(new Date()).format('YYYY-MM-DD'),
                    exitreason: '',
                    alltechnology: '',
                    sitevaluation: '',
                    businessimpact: '',
                    whetherentry: '',
                    countermeasure: '',
                    exits: '1',
                    lockernumber:'',
                },
                tableData: [{
                    group_id: '',
                    project_name: '',
                    projecttype: '',
                    exittime: '',
                    admissiontime: '',
                }],
                //性别
                code1: 'PR019',
                //学历
                code2: 'PR022',
                // 面试结果
                code3: 'BP003',
                //Rn
                code4: 'PR021',
                //技术分类
                code5: 'BP005',
                //退场理由
                code6: 'BP012',
                //所有技术
                code7: 'BP008',
                //现场评价
                code8: 'BP009',
                //対策
                code9: 'BP011',
                //業務影響
                code10: 'BP010',
                code15: 'PG021',
                //作业形态
                code20: 'BP024',
                //作业分类
                code21: 'BP025',
                result1: "",
                disabled: true,
                rules: {
                    //AD域账号
                    accountname: [
                        {
                            required: true,
                            message:
                                this.$t('normal.error_08') +
                                this.$t('label.PFANSUSERFORMVIEW_ADFIELD'),
                            trigger: 'blur',
                        },
                    ],
                    // 姓名
                    expname: [
                        {
                            required: true,
                            validator: checkexpname,
                            trigger: 'change',
                        }],
                    // 性别
                    sex: [
                        {
                            required: true,
                            message: this.$t('normal.error_09') + this.$t('label.sex'),
                            trigger: 'change',
                        },
                    ],
                    //所属部门
                    group_id: [
                        {
                            required: true,
                            validator: checkgroup,
                            trigger: 'change',
                        },
                    ],
                    // 编号
                    number: [
                        {
                            required: true,
                            message: this.$t('normal.error_08') + this.$t('label.PFANSUSERFORMVIEW_JOBNUMBER'),
                            trigger: 'blur',
                        },
                    ],
                    // 供应商名称
                    suppliername: [
                        {
                            required: true,
                            validator: checksuppliername,
                            trigger: 'change',
                        },
                    ],
                    // 毕业院校
                    graduateschool: [
                        {
                            required: true,
                            validator: checkgraduateschool,
                            trigger: 'change',
                        }],
                    // 学历
                    education: [
                        {
                            required: true,
                            message: this.$t('normal.error_09') + this.$t('label.PFANS2026VIEW_EDUCATIONALBACKGROUND'),
                            trigger: 'change',
                        },
                    ],
                    //毕业年
                    graduation_year: [
                        {
                            required: true,
                            message: this.$t('normal.error_09') + this.$t('label.PFANS2024VIEW_GRADUATIONYEAR'),
                            trigger: 'change',
                        },
                    ],
                    // 作业形态
                    operationform: [
                        {
                            required: true,
                            message: this.$t('normal.error_09') + this.$t('label.PFANS6004FORMVIEW_OPERATIONFORM'),
                            trigger: 'change',
                        },
                    ],
                    // 作业分类
                    jobclassification: [
                        {
                            required: true,
                            message: this.$t('normal.error_09') + this.$t('label.PFANS6004FORMVIEW_JOBCLASSIFICATIONM'),
                            trigger: 'change',
                        },
                    ],
                    // 入场时间
                    admissiontime: [
                        {
                            required: true,
                            message: this.$t('normal.error_09') + this.$t('label.PFANS6004FORMVIEW_ADMISSIONTIME'),
                            trigger: 'change',
                        },
                        {validator: valadmissiontime, trigger: 'change'},
                    ],
                    // 技术分类
                    technology: [
                        {
                            required: true,
                            message: this.$t('normal.error_09') + this.$t('label.PFANS2003VIEW_TECHNOLOGY'),
                            trigger: 'change',
                        },
                    ],
                    // Rn
                    rn: [
                        {
                            required: true,
                            message: this.$t('normal.error_09') + this.$t('label.PFANS2003FORMVIEW_RN'),
                            trigger: 'change',
                        },
                    ],
                    // 预计退场时间
                    yjexitime: [
                        {
                            required: true,
                            message: this.$t('normal.error_09') + this.$t('label.PFANS2002FORMVIEW_YJEXITTIME'),
                            trigger: 'change',
                        },
                        {validator: valyjexitime, trigger: 'change'},
                    ],
                    // 退场时间
                    exitime: [
                        {
                            required: true,
                            message: this.$t('normal.error_09') + this.$t('label.PFANS6004FORMVIEW_EXITIME'),
                            trigger: 'change',
                        },
                        {validator: valexitime, trigger: 'change'},
                    ],
                    // 退场理由
                    exitreason: [
                        {
                            required: true,
                            message: this.$t('normal.error_09') + this.$t('label.PFANS6004FORMVIEW_EXITREASON'),
                            trigger: 'change',
                        },
                    ],
                    // 所有技术
                    // alltechnology: [
                    //   {
                    //     required: true,
                    //     message: this.$t('normal.error_09') + this.$t('label.PFANS6004FORMVIEW_ALLTECHNOLOGY'),
                    //     trigger: 'change',
                    //   },
                    // ],
                    // 現場評価
                    sitevaluation: [
                        {
                            required: true,
                            message: this.$t('normal.error_09') + this.$t('label.PFANS6004FORMVIEW_SITEVALUATION'),
                            trigger: 'change',
                        },
                    ],
                    // 業務影響
                    businessimpact: [
                        {
                            required: true,
                            message: this.$t('normal.error_09') + this.$t('label.PFANS6004FORMVIEW_BUSINESSIMPACT'),
                            trigger: 'change',
                        },
                    ],
                    // 対策
                    // countermeasure: [
                    //   {
                    //     required: true,
                    //     message: this.$t('normal.error_09') + this.$t('label.PFANS6004FORMVIEW_COUNTERMEASURE'),
                    //     trigger: 'change',
                    //   },
                    // ],
                },
                show: false,
            };
        },
        mounted() {
            if (this.$route.params._account) {
                this.selectById();
            }
            if (this.$route.params._id) {
                this.loading = true;
                this.$store
                    .dispatch('PFANS6004Store/getexpatriatesinforApplyOne', {'expatriatesinfor_id': this.$route.params._id})
                    .then(response => {
                        this.form = response;
                        //账号
                        // if(this.form.account != null){
                        //     let letaccount = this.form.account.split("K");
                        //     if(letaccount.length === 1){
                        //         this.form.account = "";
                        //     }
                        // }

                        //ccm add
                        this.$store
                            .dispatch('PFANS6004Store/getGroupexpDetail', {'expatriatesinfor_id': this.$route.params._id})
                            .then(response => {
                                this.expData = [];

                                for (let g = 0; g < response.length; g++) {
                                    let letexpData = {};
                                    if (response[g].exdatestr !== null && response[g].exdatestr !== '') {
                                        letexpData.exdatestr = moment(response[g].exdatestr).format("YYYY-MM-DD");
                                    }
                                    letexpData.group_id = response[g].group_id;
                                    let group = getOrgInfo(response[g].group_id);
                                    if (group) {
                                        letexpData.groupname = group.title;
                                    }
                                    this.expData.push(letexpData);
                                }
                            })
                            .catch(error => {
                                Message({
                                    message: error,
                                    type: 'error',
                                    duration: 5 * 1000,
                                });
                                this.loading = false;
                            });

                        //ccm add

                        if (this.form.birth != '') {
                            let birthdays = new Date(this.form.birth);
                            let d = new Date();
                            let age = 0;
                            let agenew = 0;
                            age = d.getFullYear() - birthdays.getFullYear();
                            agenew = d.getFullYear() - birthdays.getFullYear();
                            if (d.getMonth() > birthdays.getMonth() || (d.getMonth() == birthdays.getMonth() && d.getDate() > birthdays.getDate())) {
                                agenew = age;
                            } else {
                                agenew = age - 1;
                            }
                            this.age = agenew;
                        } else {
                            this.age = 0;
                        }
                        // this.form.admissiontime = moment(new Date()).format('YYYY-MM-DD');
                        this.grouporglist = this.form.group_id;
                        this.grouporglistflg = this.form.group_id;
                        this.loading = false;
                        // if (this.form.exits === '1') {
                        //     this.show = false;
                        // } else {
                        //     this.show = true;
                        // }
                    })
                    .catch(error => {
                        Message({
                            message: error,
                            type: 'error',
                            duration: 5 * 1000,
                        });
                        this.loading = false;
                    });
            }
        },
        created() {
            this.disabled = this.$route.params.disabled;
            if (this.disabled) {
                this.buttonList = [
                    {
                        key: 'save',
                        name: 'button.save',
                        disabled: false,
                        icon: 'el-icon-check',
                    },
                ];
            }
            if (this.form.exits === '1') {
                //this.show = false;
                this.rules.yjexitime[0].required = false;
                this.rules.exitime[0].required = false;
                this.rules.exitreason[0].required = false;
                //this.rules.alltechnology[0].required = false;
                this.rules.sitevaluation[0].required = false;
                this.rules.businessimpact[0].required = false;
                //this.rules.countermeasure[0].required = false;
            } else {
                //this.show = true;
                this.rules.yjexitime[0].required = true;
                this.rules.exitime[0].required = true;
                this.rules.exitreason[0].required = true;
                //this.rules.alltechnology[0].required = true;
                this.rules.sitevaluation[0].required = true;
                this.rules.businessimpact[0].required = true;
                //this.rules.countermeasure[0].required = true;
            }
        },
        methods: {
            setdisabled(val) {
                if (this.$route.params.disabled) {
                    this.disabled = val;
                }
            },
            changesex(val) {
                this.form.sex = val;
            },
            changeeducation(val) {
                this.form.education = val;
            },
            changeoperationform(val) {
                this.form.operationform = val;
                if (val === 'BP024002') {
                    this.form.number = '00000'
                } else {
                    this.form.number = ''
                }
            },
            changetechnology(val) {
                this.form.technology = val;
            },
            changejobclassification(val) {
                this.form.jobclassification = val;
            },
            changern(val) {
                this.form.rn = val;
            },
            changealltechnology(val) {
                this.form.alltechnology = val;
            },
            changesitevaluation(val) {
                this.form.sitevaluation = val;
            },
            changebusinessimpact(val) {
                this.form.businessimpact = val;
            },
            changecountermeasure(val) {
                this.form.countermeasure = val;
            },
            changeexitreason(val) {
                this.form.exitreason = val;
            },
            getGroupId(val) {
                this.form.group_id = val;
                this.grouporglist = val;
                if (!this.form.group_id || this.form.group_id === '' || val === 'undefined') {
                    this.errorgroup = this.$t('normal.error_09') + this.$t('label.department');
                } else {
                    this.errorgroup = '';
                }
            },
            chyjexitime() {
                this.form.exitreason = null;
                this.form.alltechnology = null;
                this.form.sitevaluation = null;
                this.form.businessimpact = null;
                this.form.countermeasure = null;
                this.form.exitime = null;
                this.rules.exitime[0].required = false;
                this.form.exits = '1';
                if (this.form.yjexitime != null && this.form.yjexitime != "" && this.form.yjexitime != undefined) {
                  //this.form.exitime = null;
                  this.rules.exitreason[0].required = true;
                  this.rules.sitevaluation[0].required = true;
                  this.rules.businessimpact[0].required = true;
                } else {
                  this.rules.exitreason[0].required = false;
                  this.rules.sitevaluation[0].required = false;
                  this.rules.businessimpact[0].required = false;
                  this.erroradmissiontime = '';
                  this.errorexitime = '';
                  this.erroryjexitime = '';
                }
            },
            chexitime() {
                this.form.exitreason = null;
                this.form.alltechnology = null;
                this.form.sitevaluation = null;
                this.form.businessimpact = null;
                this.form.countermeasure = null;
                this.form.yjexitime = null;
                this.rules.exitime[0].required = false;
                if (this.form.exitime != null && this.form.exitime != "" && this.form.exitime != undefined) {
                  //this.form.exitime = null;
                  this.form.exits = '0';
                  this.rules.exitreason[0].required = true;
                  this.rules.sitevaluation[0].required = true;
                  this.rules.businessimpact[0].required = true;
                } else {
                  this.form.exits = '1';
                  this.rules.exitreason[0].required = false;
                  this.rules.sitevaluation[0].required = false;
                  this.rules.businessimpact[0].required = false;
                  this.erroradmissiontime = '';
                  this.errorexitime = '';
                  this.erroryjexitime = '';
                }
              alert(this.form.exits)
            },
            selectById(val) {
                this.loading = true;
                this.$store
                    .dispatch('PFANS6004Store/getCompanyProject', {"SyspName": this.$route.params._account})
                    .then(response => {
                        for (let j = 0; j < response.length; j++) {
                            if (response[j].group_id !== null && response[j].group_id !== '') {
                                let group = getOrgInfo(response[j].group_id);
                                debugger
                                if (group) {
                                    response[j].group_id = group.title;
                                }
                            }
                            if (response[j].project_name !== null && response[j].project_name !== "") {
                                let project_name = getUserInfo(response[j].project_name);
                                if (project_name) {
                                    response[j].project_name = user.userinfo.customername;
                                }
                            }
                            if (response[j].admissiontime !== null && response[j].admissiontime !== "") {
                                response[j].admissiontime = moment(response[j].admissiontime).format("YYYY-MM-DD");
                            }
                            if (response[j].exittime !== null && response[j].exittime !== "") {
                                response[j].exittime = moment(response[j].exittime).format("YYYY-MM-DD");
                            }
                            if (response[j].projecttype !== null && response[j].projecttype !== "") {
                                let checkvalue1 = getDictionaryInfo(response[j].projecttype);
                                if (checkvalue1) {
                                    response[j].projecttype = checkvalue1.value1;
                                }

                            }
                        }
                        this.tableData = response;
                        this.loading = false;
                    })
                    .catch(error => {
                        Message({
                            message: error,
                            type: 'error',
                            duration: 5 * 1000
                        });
                        this.loading = false;
                    })
            },
            buttonClick(val) {
                this.$refs['refform'].validate(valid => {
                    if (valid) {
                        this.form.expatriatesinfor_id = this.$route.params._id;
                        this.form.admissiontime = moment(this.form.admissiontime).format('YYYY-MM-DD');
                        if (this.$route.params._id) {
                            //upd_fjl_0928  添加group修改后的确认框  start
                            if (this.grouporglistflg != null && this.grouporglistflg != '' &&
                                this.grouporglistflg != undefined && this.grouporglistflg != this.grouporglist) {
                                this.$confirm(this.$t('normal.error_priceset'), this.$t('normal.info'), {
                                    confirmButtonText: this.$t('button.confirm'),
                                    cancelButtonText: this.$t('button.cancel'),
                                    type: 'warning',
                                }).then(() => {
                                    this.loading = true;
                                    this.$store
                                        .dispatch('PFANS6004Store/updateexpatriatesinfor', this.form)
                                        .then(response => {
                                            this.data = response;
                                            this.loading = false;
                                            if (val !== 'update') {
                                                Message({
                                                    message: this.$t('normal.success_02'),
                                                    type: 'success',
                                                    duration: 5 * 1000,
                                                });
                                                if (this.$store.getters.historyUrl) {
                                                    this.$router.push(this.$store.getters.historyUrl);
                                                }
                                            }
                                        })
                                        .catch(error => {
                                            Message({
                                                message: error,
                                                type: 'error',
                                                duration: 5 * 1000,
                                            });
                                            this.loading = false;
                                        });
                                }).catch(() => {
                                    this.$message({
                                        type: 'info',
                                        message: this.$t('label.PFANS1026FORMVIEW_tipis'),
                                    });
                                });
                            } else {
                                this.loading = true;
                                this.$store
                                    .dispatch('PFANS6004Store/updateexpatriatesinfor', this.form)
                                    .then(response => {
                                        this.data = response;
                                        this.loading = false;
                                        if (val !== 'update') {
                                            Message({
                                                message: this.$t('normal.success_02'),
                                                type: 'success',
                                                duration: 5 * 1000,
                                            });
                                            if (this.$store.getters.historyUrl) {
                                                this.$router.push(this.$store.getters.historyUrl);
                                            }
                                        }
                                    })
                                    .catch(error => {
                                        Message({
                                            message: error,
                                            type: 'error',
                                            duration: 5 * 1000,
                                        });
                                        this.loading = false;
                                    });
                            }
                            //upd_fjl_0928  添加group修改后的确认框  end
                        } else {
                            this.form.admissiontime = moment(this.form.admissiontime).format('YYYY-MM-DD');
                            this.loading = true;
                            this.$store
                                .dispatch('PFANS6004Store/createexpatriatesinforApply', this.form)
                                .then(response => {
                                    this.data = response;
                                    this.loading = false;
                                    Message({
                                        message: this.$t('normal.success_01'),
                                        type: 'success',
                                        duration: 5 * 1000,
                                    });
                                    if (this.$store.getters.historyUrl) {
                                        this.$router.push(this.$store.getters.historyUrl);
                                    }
                                })
                                .catch(error => {
                                    Message({
                                        message: error,
                                        type: 'error',
                                        duration: 5 * 1000,
                                    });
                                    this.loading = false;
                                });
                        }
                    } else {
                        Message({
                            message: this.$t("normal.error_12"),
                            type: 'error',
                            duration: 5 * 1000
                        });
                    }
                });
            },
        }
    };
</script>

<style lang="scss" rel="stylesheet/scss">
  .dpSupIndex {
    .content {
      height: 34px;
      min-width: 80%;
      border: 0.1rem solid #ebeef5;
      overflow-y: scroll;
      overflow-x: hidden;
      line-height: 34px;
      padding: 0.1rem 0.5rem 0.2rem 0.5rem;
    }

    .bg {
      background: white;
      border-width: 1px;
    }
  }
</style>
